<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="/sys/common/layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="/sys/common/bootstrap/css/bootstrap.css" media="all">
    <link rel="stylesheet" type="text/css" href="/sys/common/global.css" media="all">
    <link rel="stylesheet" type="text/css" href="/sys/css/personal.css" media="all">
</head>
<body>
<section class="layui-larry-box">
    <div class="larry-personal">
        <header class="larry-personal-tit">
            <span>个人信息</span>
        </header><!-- /header -->
        <div class="larry-personal-body clearfix">
            <form class="layui-formls" id="form-SysCol" action="" method="post">
                <div class="layui-form-item"></div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="white-space:nowrap " id="colId" tips=" 主键"  > 主键 </label>
                        <div class="layui-input-block">
                            <input type="text" name="colId" id="colId_id" autocomplete="off"  class="layui-input  layui-disabled"    />
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label" style="white-space:nowrap " id="colNam" tips=" 字段名称"  >
                            字段名称 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colNam" id="colNam_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label" style="white-space:nowrap " id="colTy" tips=" 字段类型"  >
                            字段类型 </label>
                        <div class="layui-input-block" id="colTy_id" tips="select">

                        </div>
                    </div>
                </div>


                <div class="layui-form-item">
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colPat" tips=" 字段合法值正则"  >
                        字段合法值正 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colPat" id="colPat_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colFront" tips=" 前端显示字段描述"  >
                            前端显示字段 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colFront" id="colFront_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colDef" tips=" 字段默认值"  >
                            字段默认值 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colDef" id="colDef_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" style="white-space:nowrap " id="colCmt" tips=" 字段注释"  >
                        字段注释 </label>
                    <div class="layui-input-block">

                        <input type="text" name="colCmt" id="colCmt_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" style="white-space:nowrap " id="colIllMsg" tips=" 字段值非法的时候的提示"  >
                    字段值非法的 </label>
                    <div class="layui-input-block">

                        <input type="text" name="colIllMsg" id="colIllMsg_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colTbid" tips=" 对应表ID"  >
                            对应表ID </label>
                        <div class="layui-input-block">

                            <input type="text" name="colTbid" id="colTbid_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colSort" tips=" 表单顺序"  >
                        表单顺序 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colSort" id="colSort_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colSer" tips=" 是否为被搜索字段"  >
                        是否为被搜索 </label>
                        <div class="layui-input-block">
                            <input name="colSer" id="colSer_id"  lay-text="是|否" value="否"  type="checkbox"  >
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline ">
                    <label class="layui-form-label" style="white-space:nowrap " id="colForeTb" tips=" 外键对应表"  >
                    外键对应表 </label>
                    <div class="layui-input-block">

                        <input type="text" name="colForeTb" id="colForeTb_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colForCol" tips=" 外键对应字段"  >
                        外键对应字段 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colForCol" id="colForCol_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colRonly" tips=" 是否在表单显示只读"  >
                            是否只读 </label>
                        <div class="layui-input-block">
                            <input name="colRonly" id="colRonly_id"  lay-text="是|否" lay-filter="isShow" value="否" type="checkbox">
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colImgw" tips=" 如果是图片表单，缩略图宽度"  >
                        如果是图片表 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colImgw" id="colImgw_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colImgh" tips=" 如果是图片表单，缩略图高度"  >
                        如果是图片表 </label>
                        <div class="layui-input-block">

                            <input type="text" name="colImgh" id="colImgh_id"
                                   autocomplete="off"  class="layui-input "    />
                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colRich" tips=" 是否用富客户端"  >
                        是否用富客户 </label>
                        <div class="layui-input-block">
                            <input name="colRich" id="colRich_id"  lay-text="是|否" lay-filter="isShow" value="否" type="checkbox">
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colShowinForm" tips=" 是否在表单显示"  >
                            是否在表单显示 </label>
                        <div class="layui-input-block">
                            <input name="colSer" id="colShowinForm_id"  lay-text="是|否" value="否"  type="checkbox"  >
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colShowinTable" tips=" 是否在表格中显示"  >
                            是否在表格中显示 </label>
                        <div class="layui-input-block">
                            <input name="colSer" id="colShowinTable_id"  lay-text="是|否" value="否"  type="checkbox"  >
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                    <div class="layui-inline ">
                        <label class="layui-form-label" style="white-space:nowrap " id="colIsSort" tips=" 是否允许排序"  >
                            是否允许排序 </label>
                        <div class="layui-input-block">
                            <input name="colSer" id="colIsSort_id"  lay-text="是|否" value="否"  type="checkbox"  >
                            <div class="layui-unselect layui-form-switch"><i></i></div>

                        </div>
                    </div>
                </div>
                <div class="layui-form-item">

                    <label class="layui-form-label" style="white-space:nowrap " id="colFormTy" tips=" 表单类型，input|text|img|video|radio|cbx"  >
                        表单类型，i </label>

                    <div class="layui-input-block" id="colFormTy_id">
                        <label   class="hb-radio">
                            <span class="hb-radio-bg"></span>
                            <input type="radio" name="colFormTy"   value="input" checked="checked" /> input
                            <span class="hb-radio-on"></span>
                        </label>
                        <label   class="hb-radio">
                            <span class="hb-radio-bg"></span>
                            <input type="radio" name="colFormTy"  value="text" /> text
                            <span class="hb-radio-on"></span>
                        </label>
                        <label   class="hb-radio">
                            <span class="hb-radio-bg"></span>
                            <input type="radio" name="colFormTy"  value="text" /> radio
                            <span class="hb-radio-on"></span>
                        </label>
                        <label   class="hb-radio">
                            <span class="hb-radio-bg"></span>
                            <input type="radio" name="colFormTy"  value="checkbox" /> checkbox
                            <span class="hb-radio-on"></span>
                        </label>
                        <label   class="hb-radio">
                            <span class="hb-radio-bg"></span>
                            <input type="radio" name="colFormTy"  value="radio" /> radio
                            <span class="hb-radio-on"></span>
                        </label>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="white-space:nowrap " id="colFormDs" tips=" 表单是cbx,radio,combo时候的数据源"  >
                        表单数据源 </label>
                    <div class="layui-input-block">

                        <input type="text" name="colIndex" id="colFormDs_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="white-space:nowrap " id="colIndex" tips=" 索引类型,none表示非索引"  >
                    索引类型,n </label>
                    <div class="layui-input-block">

                        <input type="text" name="colIndex" id="colIndex_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="white-space:nowrap " id="colFntFmt" tips=" 前端显示格式化代码(thymeleaf)"  >
                    前端显示格式 </label>
                    <div class="layui-input-block">

                        <input type="text" name="colFntFmt" id="colFntFmt_id"
                               autocomplete="off"  class="layui-input "    />
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <a class="layui-btn" id="btn-submit">立即提交</a>
                        <a type="reset" class="layui-btn layui-btn-primary">重置</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
<script type="text/javascript" src="/sys/common/layui/layui.js"></script>
<script type="text/javascript">
    layui.use(['form','upload','jquery' ],function(){
        var form = layui.form();
        layui.upload({
            url: '' ,//上传接口
            success: function(res){
                //上传成功后的回调
                console.log(res)
            }
        });
    $ = layui.jquery;
        $('.layui-form-label').each(function () {
            var dom=$(this);
            var domId=$(this).attr("id");
            $(dom).on( 'mouseover', function() {
                layui.layer.tips($(dom).attr("tips"), '#'+domId, {
                    tips: [2, '#0FA6D8'], //设置tips方向和颜色 类型：Number/Array，默认：2 tips层的私有参数。支持上右下左四个方向，通过1-4进行方向设定。如tips: 3则表示在元素的下面出现。有时你还可能会定义一些颜色，可以设定tips: [1, '#c00']
                    tipsMore: false, //是否允许多个tips 类型：Boolean，默认：false 允许多个意味着不会销毁之前的tips层。通过tipsMore: true开启
                    time:2000  //2秒后销毁，还有其他的基础参数可以设置。。。。这里就不添加了
                });
            });
        });
        var submitType='PUT' ;
        $( "#btn-submit" ).click(function () {

            var index = top.layer.msg('数据提交中，请稍候',{icon: 16,time:false,shade:0.8});
            var d = {};
            var t = $("#form-SysCol").serializeArray();
            $.each(t, function() {
                d[this.name] = this.value;
            });

            $.ajax({
                url :  "/SysCol",
                type :submitType ,
                data : JSON.stringify(d)  , //转JSON字符串
                //dataType: "json",//说明返回的数据类型，这里返回的是json类型
                contentType:'application/json;charset=UTF-8', //contentType很重要
                success: function (msg) {


                },
                complete: function (data) {
                    if(data.responseText=='添加信息成功!'||data.responseText=='修改信息成功!'){
                        submitType='PUT';
                        top.layer.close(index);
                        top.layer.msg(data.responseText);
                    }
                },
                error: function (XMLHttpRequest, textStatus, thrownError) {
                }
            });

        });
        function getCombox(options,tar) {
            var dataHtml = '<select name="interest" lay-filter="aihao">';
            var tarText;
            for(var i=0;i<options.length;i++){

                if(options[i].dtyId==tar){
                    dataHtml+='<option value="'+options[i].dtyId+'" selected="selected">'+options[i].dtyNam+'</option>'
                    tarText=options[i].dtyNam;


                }else {
                    dataHtml+='<option value="'+options[i].dtyId+'"  >'+options[i].dtyNam+'</option>'

                }
            }
            dataHtml+='</select>';
            dataHtml+='<div class="layui-unselect layui-form-select"><div class="layui-select-title"><input placeholder="varchar16" value="'+tarText+'" readonly="" class="layui-input layui-unselect" type="text"><i class="layui-edge"></i></div><dl class="layui-anim layui-anim-upbit"> ';

            for(var i=0;i<options.length;i++){
                if(options[i].dtyId==tar){
                    dataHtml+='<dd lay-value="'+options[i].dtyId+'" class="layui-this">'+options[i].dtyNam+'</dd>'
                }else {
                    dataHtml+='<dd lay-value="'+options[i].dtyId+'"  > '+options[i].dtyNam+ '</dd>'
                }
            }
            dataHtml+='</dl></div>';
            return dataHtml;
        }
        var SysDataType = '';
        $.get("/SysDataType/list", function(data){
            SysDataType=data;
            $("#colTy_id").html(getCombox(SysDataType,'ghf4'));
            renderForm();
            bindData( );
        });
        function renderForm() {
            $(".layui-select-title").each(function () {
                var x=$(this);
                x.click(function () {
                    var className=(x.parent().attr("class"));
                    if(className.indexOf("selected")>0)
                        x.parent().removeClass("layui-form-selected");
                    else
                        x.parent().addClass("layui-form-selected");

                });
                x.next().find("dd").each(function () {
                    $(this).click(function () {
                        $(this).addClass("layui-this");
                        $(this).siblings().removeClass("layui-this");
                        $(this).parent().parent().removeClass("layui-form-selected");

                        $(this).parent().prev().find("input").val($(this).text());
                        var temp=$(this).parent().parent().prev();
                        temp.find("option[value = '"+$(this).attr("lay-value")+"']").attr("selected","selected");
                        temp.find("option[value = '"+$(this).attr("lay-value")+"']").siblings().removeAttr("selected");
                    })
                });
                x.parent().prev().css("display","none");

                var child = $('input[type="checkbox"]');
                child.each(function( ){
                    $(this).next().click(function () {

                        var className=($(this).attr("class"));
                        if(className.indexOf("onswitch")>0){
                            $(this).removeClass("layui-form-onswitch");
                            $(this).prev().prop("checked",false);

                        } else{
                            $(this).addClass("layui-form-onswitch");
                            $(this).prev().val("是");
                            $(this).prev().prop("checked","checked");
                        }


                    });
                    $(this).css("display","none");
                });



            });
        }
        function getQueryString(name) {


            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg); //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
        function bindData( ) {
            $.get("/SysCol?colId="+getQueryString("colId"), function(data){
                bindFromData(data);

            });

        }
        function bindFromData(data) {
            if(data!=undefined){
                $.each(data,function(n,value){
                    //console.log(n+'||'+value);
                    var dom=$("#"+n+"_id");
                    if(dom!=undefined){

                        if(dom.attr("type")=='text' )
                        {
                            dom.val( value);
                        }
                        else if(dom.attr("type")=='checkbox' )
                        {
                            if(dom.attr("lay-text")!=undefined)
                            {
                                if(value=='是'){
                                    dom.next().addClass("layui-form-onswitch");
                                    dom.val("是");
                                    dom.prop("checked","checked");
                                }else{
                                    dom.next().removeClass("layui-form-onswitch");
                                    dom.prop("checked",false);
                                }
                            }
                        }else if(dom.attr("tips")=='select' )
                        {
                            dom.find("dd").each(function () {
                                if($(this).attr("lay-value")==value){
                                    $(this).addClass("layui-this");
                                    $(this).siblings().removeClass("layui-this");
                                    dom.find("input").val($(this).text());

                                }
                            });
                            dom.find("select").attr("name", n);
                            dom.find("select").find("option[value = '"+value+"']").attr("selected","selected");
                            dom.find("select").find("option[value = '"+value+"']").siblings().removeAttr("selected");
                        }
                    }
                });
            }
        }
    });


</script>
</body>
</html>